# Учебная Виртуальная Машина (УВМ)

Данный проект представляет собой ассемблер и интерпретатор для Учебной Виртуальной Машины (УВМ). Ассемблер преобразует текстовый файл исходного кода в бинарный файл, содержащий инструкции в машинном коде. Интерпретатор выполняет эти команды, взаимодействует с памятью и регистровой системой и сохраняет результат в заданном диапазоне памяти в XML-файл.

## Структура проекта

1. **Assembler**: Преобразует текстовый файл с кодом в бинарный файл, а также создает лог-файл XML с командами в виде списков ключ-значение.
2. **Interpreter**: Выполняет бинарные команды из файла, выполняет операции над регистрами и памятью и сохраняет результаты выполнения в файл XML.

## Форматы команд УВМ

Команды УВМ имеют фиксированный формат:

1. **LOAD_CONSTANT** — загрузка константы в регистр.
    - Размер команды: 4 байта.
    - Формат:
        - **A** (7 бит): Код операции (98 для `LOAD_CONSTANT`)
        - **B** (22 бита): Константа
        - **C** (3 бита): Адрес регистра, куда загрузить константу
    - Пример (A=98, B=825, C=3):  
      `0xE2, 0x9C, 0x01, 0x60`

2. **MEMORY_READ** — чтение из памяти в регистр.
    - Размер команды: 5 байт.
    - Формат:
        - **A** (7 бит): Код операции (109 для `MEMORY_READ`)
        - **B** (3 бита): Адрес регистра для сохранения результата
        - **C** (16 бит): Адрес памяти для чтения
    - Пример (A=109, B=2, C=742):  
      `0x6D, 0x99, 0x0B, 0x00, 0x00`

3. **MEMORY_WRITE** — запись из регистра в память.
    - Размер команды: 4 байта.
    - Формат:
        - **A** (7 бит): Код операции (17 для `MEMORY_WRITE`)
        - **B** (3 бита): Адрес регистра с базовым адресом
        - **C** (16 бит): Смещение для адресации памяти
        - **D** (3 бита): Адрес регистра, из которого записывать значение
    - Пример (A=17, B=5, C=843, D=0):  
      `0x91, 0x2E, 0x0D, 0x00`

4. **ABS** — унарная операция взятия абсолютного значения.
    - Размер команды: 2 байта.
    - Формат:
        - **A** (7 бит): Код операции (57 для `ABS`)
        - **B** (3 бита): Адрес регистра для сохранения результата
        - **C** (3 бита): Адрес регистра с исходным значением
    - Пример (A=57, B=2, C=3):  
      `0x39, 0x0D`

## Запуск ассемблера и интерпретатора

### Ассемблер

Ассемблер принимает на вход файл с текстом программы, путь к которому задается через командную строку, и создает бинарный файл с ассемблированными инструкциями, а также XML-файл лога.

Пример запуска:

```bash
./assembler ../files/input.asm ../files/output.bin ../files/log.xml
```

- `../files/input.asm` — путь к текстовому файлу исходного кода.
- `../files/output.bin` — путь к бинарному файлу с ассемблированным кодом.
- `../files/log.xml` — путь к XML-файлу, содержащему лог команд в виде ключ-значение.

### Интерпретатор

Интерпретатор выполняет команды из бинарного файла, указанного в командной строке, и сохраняет в файл-результат диапазон значений памяти.

Пример запуска:

```bash
./interpreter ../files/output.bin ../files/result.xml 0 1024
```

- `../files/output.bin` — путь к бинарному файлу с ассемблированным кодом.
- `../files/result.xml` — путь к XML-файлу для сохранения диапазона значений памяти.
- `0` и `1024` — диапазон адресов памяти для вывода в файл-результат.

## Тестовая программа

Тестовая программа выполняет поэлементное взятие абсолютного значения (`ABS`) над вектором длины 4 и записывает результат обратно в исходный вектор. Пример команды для вектора:

```asm
LOAD_CONSTANT R1, #-12
LOAD_CONSTANT R2, #12
LOAD_CONSTANT R3, #-52
LOAD_CONSTANT R4, #52

MEMORY_WRITE [R0 + 0], R1
MEMORY_WRITE [R0 + 1], R2
MEMORY_WRITE [R0 + 2], R3
MEMORY_WRITE [R0 + 3], R4

LOAD_CONSTANT R1, #0
LOAD_CONSTANT R2, #1
LOAD_CONSTANT R3, #2
LOAD_CONSTANT R4, #3

ABS [R1], R1
ABS [R2], R2
ABS [R3], R3
ABS [R4], R4

MEMORY_WRITE [R0 + 0], R1
MEMORY_WRITE [R0 + 1], R2
MEMORY_WRITE [R0 + 2], R3
MEMORY_WRITE [R0 + 3], R4


```

Вектор записывается в память, производится операция `ABS` над каждым элементом и сохраняется в память.
